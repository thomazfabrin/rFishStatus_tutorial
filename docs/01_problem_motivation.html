<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>problem_motivation – rFishStatus</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-de070a7b0ab54f8780927367ac907214.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-5d2e30ad26079c1dae90a1fd11eba2b9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01_problem_motivation.html">rFishStatus &amp; DSRM</a></li><li class="breadcrumb-item"><a href="./01_problem_motivation.html">Problem &amp; Motivation</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">rFishStatus</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">rFishStatus &amp; DSRM</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_problem_motivation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Problem &amp; Motivation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_objectives.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Objectives</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_design_development.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Design &amp; Development</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_demonstration_tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Demonstration &amp; Tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Evaluation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_communication_conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Communication &amp; Conclusion</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-challenge-of-fish-nomenclature-conflicts" id="toc-the-challenge-of-fish-nomenclature-conflicts" class="nav-link active" data-scroll-target="#the-challenge-of-fish-nomenclature-conflicts">The Challenge of Fish Nomenclature Conflicts</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01_problem_motivation.html">rFishStatus &amp; DSRM</a></li><li class="breadcrumb-item"><a href="./01_problem_motivation.html">Problem &amp; Motivation</a></li></ol></nav></header>




<section id="the-challenge-of-fish-nomenclature-conflicts" class="level2">
<h2 class="anchored" data-anchor-id="the-challenge-of-fish-nomenclature-conflicts">The Challenge of Fish Nomenclature Conflicts</h2>
<p>Several scientific investigations rely on accurate species identification and distribution data to draw conclusions across a wide range of research topics. This includes descriptive taxonomic and/or molecular identification studies as well as more complex modeling of species distribution over time to formulate assumptions. In any case, both approaches require robust and accurate species identification as a prerequisite. However, to ensure the reliability of species databases, innovative tools capable of addressing these challenges are needed. From a taxonomic perspective, challenges also persist regarding the incorporation of newly discovered taxa into these databases, alongside concerns about the reliability of the information contained therein, particularly considering that <strong>these resources are mainly accessed by non-taxonomist end-users</strong> <span class="citation" data-cites="ebach_impediments_2011">(<a href="#ref-ebach_impediments_2011" role="doc-biblioref">Ebach, Valdecasas, and Wheeler 2011</a>)</span>. This is an important aspect since several commonly used databases are not synchronous regarding species status updates.</p>
<p>The primary route for accessing taxonomic information relies on public databases, accessible to both taxonomists and non-taxonomists. These databases are hosted on web platforms like FishBase and Eschmeyer’s Catalog of Fishes. Additionally, there are specific packages designed to curate and construct local species databases. However, <strong>a challenge arises in validating species nomenclature from databases that do not synchronously update with species status changes</strong>, especially for occurrence entries made by non-taxonomist users without cross-verification. To mitigate errors in data entry into these databases, several potential solutions have emerged. These solutions include the adoption of molecular identification techniques such as DNA barcoding, which facilitates species identification <span class="citation" data-cites="desalle_review_2019">(<a href="#ref-desalle_review_2019" role="doc-biblioref">DeSalle and Goldstein 2019</a>)</span>, and the expansion of taxonomic expertise through the training of more taxonomists. <em>Taxonomists play a crucial role in reviewing and validating species identification and nomenclature before new data are added to these databases</em> <span class="citation" data-cites="ebach_impediments_2011">(<a href="#ref-ebach_impediments_2011" role="doc-biblioref">Ebach, Valdecasas, and Wheeler 2011</a>)</span>.</p>
<p>The correct identification and classification of organisms present multiple challenges, and their impact varies depending on the scientific, social, and political context. Poor taxonomic hypotheses, for instance, can result in misguided conservation priorities. The differentiation and discovery of species, while distinct terms, rely heavily on the foundation of trustworthy pre-existing information, which is predominantly accessed through these databases. Despite the partial automation of certain processes, taxonomic scrutiny remains important, particularly for taxonomic groups that remain incompletely understood. Consequently, the development of tools aimed at rectifying and validating data within cyber-infrastructures used for disseminating taxonomic information to end-users is important <span class="citation" data-cites="de_carvalho_revisiting_2005 de_carvalho_taxonomic_2007">(<a href="#ref-de_carvalho_revisiting_2005" role="doc-biblioref">De Carvalho et al. 2005</a>, <a href="#ref-de_carvalho_taxonomic_2007" role="doc-biblioref">2007</a>)</span>. This is especially true given that the majority of end-users lack taxonomic expertise and often need to integrate data from various databases into a unique dataset for posterior analysis.</p>
<p>In light of this, the demand for automation is increasing in the era of big data. Processing such data needs highly specialized tools that can be customized by end-users to align with their requirements. These tools have the potential to not only flag incorrect species status but also propose possible corrections, thereby contributing to the generation of more reliable data. The main challenge is taxonomic harmonization, the process of matching species names with those from a reference database, if not the main one, and checking their status. To avoid reinventing the wheel, the primary step is combining existing tools into <strong>a unified solution that facilitates a “clean” and streamlined workflow for harmonizing taxonomic information</strong>, making it accessible for different types of research. This necessitates the fusion of web knowledge, biological background, and programming development skills, enabling the processing and organization of online data to create an accessible resource <span class="citation" data-cites="grenie_harmonizing_2023">(<a href="#ref-grenie_harmonizing_2023" role="doc-biblioref">Grenié et al. 2023</a>)</span>.</p>
<p>Here, we introduce an R package designed for managing fish nomenclature data. Our goal was to process the data to generate a species list as curated and updated as possible. Additionally, we provide functions to update the status and nomenclature of species in occurrence datasets from the Global Biodiversity Information Facility (GBIF), and to interpret and compare species input data. To test <code>rFishStatus</code>, we used the Design Science Research Methodology (DSRM), following specific guidelines <span class="citation" data-cites="lacerda_design_2013 hevner_design_2010 peffers_design_2007">(<a href="#ref-lacerda_design_2013" role="doc-biblioref">Lacerda et al. 2013</a>; <a href="#ref-hevner_design_2010" role="doc-biblioref">Hevner and Chatterjee 2010</a>; <a href="#ref-peffers_design_2007" role="doc-biblioref">Peffers et al. 2007</a>)</span>. The primary objective was to address the challenges associated with curating input lists of fish species, either sourced from users or occurrence datasets. The usage of the package is demonstrated across various scenarios.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-de_carvalho_taxonomic_2007" class="csl-entry" role="listitem">
De Carvalho, Marcelo R., Flávio A. Bockmann, Dalton S. Amorim, Carlos Roberto F. Brandão, Mário De Vivo, José L. De Figueiredo, Heraldo A. Britski, et al. 2007. <span>“Taxonomic Impediment or Impediment to Taxonomy? A Commentary on Systematics and the Cybertaxonomic-Automation Paradigm.”</span> <em>Evolutionary Biology</em> 34 (3): 140–43. <a href="https://doi.org/10.1007/s11692-007-9011-6">https://doi.org/10.1007/s11692-007-9011-6</a>.
</div>
<div id="ref-de_carvalho_revisiting_2005" class="csl-entry" role="listitem">
De Carvalho, Marcelo R., Flávio A. Bockmann, Dalton S. Amorim, Mário De Vivo, Mônica De Toledo-Piza, Naércio A. Menezes, José L. De Figueiredo, et al. 2005. <span>“Revisiting the Taxonomic Impediment.”</span> <em>Science</em> 307 (5708): 353–53. <a href="https://doi.org/10.1126/science.307.5708.353b">https://doi.org/10.1126/science.307.5708.353b</a>.
</div>
<div id="ref-desalle_review_2019" class="csl-entry" role="listitem">
DeSalle, Rob, and Paul Goldstein. 2019. <span>“Review and Interpretation of Trends in <span>DNA</span> Barcoding.”</span> <em>Frontiers in Ecology and Evolution</em> 7 (September): 302. <a href="https://doi.org/10.3389/fevo.2019.00302">https://doi.org/10.3389/fevo.2019.00302</a>.
</div>
<div id="ref-ebach_impediments_2011" class="csl-entry" role="listitem">
Ebach, Malte C., Antonio G. Valdecasas, and Quentin D. Wheeler. 2011. <span>“Impediments to Taxonomy and Users of Taxonomy: Accessibility and Impact Evaluation.”</span> <em>Cladistics</em> 27 (5): 550–57. <a href="https://doi.org/10.1111/j.1096-0031.2011.00348.x">https://doi.org/10.1111/j.1096-0031.2011.00348.x</a>.
</div>
<div id="ref-grenie_harmonizing_2023" class="csl-entry" role="listitem">
Grenié, Matthias, Emilio Berti, Juan Carvajal‐Quintero, Gala Mona Louise Dädlow, Alban Sagouis, and Marten Winter. 2023. <span>“Harmonizing Taxon Names in Biodiversity Data: A Review of Tools, Databases and Best Practices.”</span> <em>Methods in Ecology and Evolution</em> 14 (1): 12–25. <a href="https://doi.org/10.1111/2041-210X.13802">https://doi.org/10.1111/2041-210X.13802</a>.
</div>
<div id="ref-hevner_design_2010" class="csl-entry" role="listitem">
Hevner, Alan, and Samir Chatterjee. 2010. <span>“Design Science Research in Information Systems.”</span> In <em>Design Research in Information Systems</em>, by Alan Hevner and Samir Chatterjee, 22:9–22. Boston, <span>MA</span>: Springer <span>US</span>. <a href="https://doi.org/10.1007/978-1-4419-5653-8_2">https://doi.org/10.1007/978-1-4419-5653-8_2</a>.
</div>
<div id="ref-lacerda_design_2013" class="csl-entry" role="listitem">
Lacerda, Daniel Pacheco, Aline Dresch, Adriano Proença, and José Antonio Valle Antunes Júnior. 2013. <span>“Design Science Research: método de pesquisa para a engenharia de produção.”</span> <em>Gestão &amp; Produção</em> 20 (4): 741–61. <a href="https://doi.org/10.1590/S0104-530X2013005000014">https://doi.org/10.1590/S0104-530X2013005000014</a>.
</div>
<div id="ref-peffers_design_2007" class="csl-entry" role="listitem">
Peffers, Ken, Tuure Tuunanen, Marcus A. Rothenberger, and Samir Chatterjee. 2007. <span>“A Design Science Research Methodology for Information Systems Research.”</span> <em>Journal of Management Information Systems</em> 24 (3): 45–77. <a href="https://doi.org/10.2753/MIS0742-1222240302">https://doi.org/10.2753/MIS0742-1222240302</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>